.build:
  stage: build
  rules:
    - !reference [.default_rules, rules]
  before_script:
    - !reference [.setup, before_script]
  script:
    # Build images
    - |
      werf build \
        --save-build-report --build-report-path images_tags_werf.json
  artifacts:
    paths:
      - images_tags_werf.json
    expire_in: "30 days"

.svace_rules_mr:
  rules:
    - if: '$CI_MERGE_REQUEST_LABELS =~ /(^|,)analyze\/svace(,|$)/'
      variables:
        SVACE_ENABLED: "true"

.svace_rules_manual:
  rules:
    - if: $CI_PIPELINE_SOURCE == "web" && $SVACE_ENABLED == "true" && $CI_COMMIT_BRANCH
      variables:
        SVACE_ENABLED: "true"

.svace_rules_schedule:
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule" && $SVACE_ENABLED == "true" && $CI_COMMIT_BRANCH
      variables:
        SVACE_ENABLED: "true"